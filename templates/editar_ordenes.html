{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Editar Órden - Atom</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>

<body class="bg-light p-4" style="font-family: 'Montserrat', sans-serif;">

<div class="container" style="max-width: 700px;">
    
    <h2 class="mb-4">Editar órden #{{ orden.numero_control }}</h2>

    {# MENSAJES DE ERROR / ÉXITO #}
    {% if messages %}
      <div class="mb-3">
        {% for message in messages %}
          <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
          </div>
        {% endfor %}
      </div>
    {% endif %}

    <form method="POST">
        {% csrf_token %}

        <div class="mb-3">
            <label class="form-label">Cliente</label>
            <input type="text" name="cliente" class="form-control" value="{{ orden.cliente.nombre }}" required>
        </div>

        <div class="mb-3">
            <label class="form-label">Marca</label>
            <input type="text" name="marca" class="form-control" value="{{ orden.marca.nombre_marca }}" required>
        </div>

        <div class="mb-3">
            <label class="form-label">Modelo</label>
            <input type="text" name="modelo" class="form-control" value="{{ orden.modelo.nombre_modelo }}" required>
        </div>
        <div class="mb-3">
            <label for="fecha" class="form-label">Fecha</label>
            <input 
                type="date"
                id="fecha"
                name="fecha"
                class="form-control"
                value="{{ orden.fecha|date:'Y-m-d' }}">
        </div>

        <!-- TOTAL -->
        <div class="mb-3">
            <label for="total" class="form-label">Total</label>
            <input
                type="number"
                step="0.01"
                min="0"
                max="9999999.99"
                name="total"
                id="total"
                class="form-control"
                value="{{ orden.total_pagar }}"
                
            >
        </div>

        <!-- ABONO -->
        <div class="mb-3">
            <label for="abono" class="form-label">Abono</label>
            <input
                type="number"
                step="0.01"
                min="0"
                max="9999999.99"
                name="abono"
                id="abono"
                class="form-control"
                value="{{ orden.abono }}"
            >
        </div>

        <div class="mb-3">
            <label class="form-label">Estado</label>
            <select name="estado" class="form-select">
                {% for est in estados %}
                    <option value="{{ est.id }}" {% if orden.estado.id == est.id %}selected{% endif %}>
                        {{ est.tipo_estado }}
                    </option>
                {% endfor %}
            </select>
        </div>

        <div class="mb-3">
            <label class="form-label">Observaciones</label>
            <textarea name="observaciones" class="form-control" rows="4">{{ orden.observaciones }}</textarea>
        </div>

        <!-- BOTONES -->
        <div class="d-flex justify-content-between mt-4">

            <button type="submit" name="guardar" class="btn btn-primary">
                Guardar cambios
            </button>

            <!-- Botón para mostrar modal -->
            <button type="button" class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#modalEliminar">
                Eliminar
            </button>

            <a href="{% url 'ordenes_trabajo' %}" class="btn btn-secondary">
                Volver
            </a>
        </div>

        <!-- MODAL DE CONFIRMACIÓN ELIMINAR -->
        <div class="modal fade" id="modalEliminar" tabindex="-1" aria-labelledby="modalEliminarLabel" aria-hidden="true">
          <div class="modal-dialog">
            <div class="modal-content">
              
              <div class="modal-header">
                <h5 class="modal-title" id="modalEliminarLabel">Confirmar eliminación</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
              </div>
              
              <div class="modal-body">
                ¿Seguro que deseas eliminar la órden #{{ orden.numero_control }}?
                Esta acción no se puede deshacer.
              </div>
              
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <!-- Este botón envía el formulario con name="eliminar" -->
                <button type="submit" name="eliminar" class="btn btn-danger">
                    Sí, eliminar
                </button>
              </div>

            </div>
          </div>
        </div>

    </form>

</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
